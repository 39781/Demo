<html>
<head>
<meta name="google-signin-client_id" content="93244704256-qao2ngc31bb93k1uifsn42ffo5rmsbs1.apps.googleusercontent.com"></meta>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
<script src="https://apis.google.com/js/platform.js" async defer></script>
<script>
(function(d, s, id){
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.com/en_US/messenger.Extensions.js";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'Messenger'));
window.extAsyncInit = function() {
  // the Messenger Extensions JS SDK is done loading 
};
function findGetParameter(parameterName) {
    var result = null,
        tmp = [];
    window.location.search
        .substr(1)
        .split("&")
        .forEach(function (item) {
          tmp = item.split("=");
          if (tmp[0] === parameterName) result = decodeURIComponent(tmp[1]);
        });
		console.log(result);
    return result;
}
function onSignIn(googleUser) {
	var profile = googleUser.getBasicProfile();
	var id_token = googleUser.getAuthResponse().id_token;  
	console.log('Name: ' + profile.getName());
	var rid = findGetParameter('rid');	
	var xhr = new XMLHttpRequest();
	xhr.onreadystatechange = function() {
		console.log(this.readyState);
		if (this.readyState == 4 && this.status == 200) {			
			window.close();
			// findGetParameter('redirect_uri');+'&authorization_code=12344';
			document.getElementById("status").innerHTML = "user validated : login success";
			return webViewClose(profile.getName());		   
		}else{
			document.getElementById("status").innerHTML = "Invalid user please sign in with valid user";
		}
	};
	xhr.open('POST', 'https://desolate-beach-84758.herokuapp.com/validateUser',true);
	xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");		
	xhr.send(JSON.stringify({accessToken:id_token,recipientId:rid}));
}


</script>

</head>
<body>
<div class="g-signin2" data-longtitle="true"></div>


<div id="status"></div>
</body>
</html>